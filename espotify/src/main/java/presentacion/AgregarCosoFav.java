package presentacion;

import java.util.Collection;
import javax.swing.DefaultListModel;
import javax.swing.JOptionPane;
import logica.controladores.IControladorCliente;
import logica.controladores.IControladorTema;
import logica.controladores.IControladorListaParticular;
import logica.controladores.IControladorListaPorDefecto;
import logica.controladores.IControladorAlbum;
import logica.dt.DataAlbum;
import logica.dt.DataCliente;
import logica.dt.DataListaParticular;
import logica.dt.DataListaPorDefecto;
import logica.dt.DataTema;

public class AgregarCosoFav extends javax.swing.JPanel {

    private final IControladorCliente controlCli;
    private final IControladorTema controlTema;
    private final IControladorListaParticular controlLipa;
    private final IControladorListaPorDefecto controlLiporde;
    private final IControladorAlbum controlAlb;

    public AgregarCosoFav(IControladorCliente icc, IControladorTema ict, IControladorListaParticular iclp, IControladorListaPorDefecto iclpd, IControladorAlbum ica) {
        initComponents();
        lblFav.setVisible(false);
        lstCoso.setVisible(false);
        txtFav.setVisible(false);
        btnConfirmar.setVisible(false);

        controlCli = icc;
        controlAlb = ica;
        controlLipa = iclp;
        controlLiporde = iclpd;
        controlTema = ict;
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel2 = new javax.swing.JLabel();
        txtNick = new javax.swing.JTextField();
        cbxTipoCoso = new javax.swing.JComboBox<>();
        btnConfirmar = new javax.swing.JButton();
        btnBuscar = new javax.swing.JButton();
        jScrollPane2 = new javax.swing.JScrollPane();
        lstCoso = new javax.swing.JList<>();
        txtFav = new javax.swing.JTextField();
        lblFav = new javax.swing.JLabel();
        txtCreadorGenero = new javax.swing.JTextField();
        lblCreadorGenero = new javax.swing.JLabel();
        cbxListasLPM = new javax.swing.JComboBox<>();
        lblFavList = new javax.swing.JLabel();

        setPreferredSize(new java.awt.Dimension(860, 471));

        jLabel2.setText("Nick Cliente :");

        txtNick.setColumns(10);

        cbxTipoCoso.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "OPT", "Tema", "Lista", "Album", " " }));
        cbxTipoCoso.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbxTipoCosoActionPerformed(evt);
            }
        });

        btnConfirmar.setText("OK");
        btnConfirmar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnConfirmarActionPerformed(evt);
            }
        });

        btnBuscar.setText("Buscar");
        btnBuscar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnBuscarActionPerformed(evt);
            }
        });

        lstCoso.setModel(new javax.swing.AbstractListModel<String>() {
            String[] strings = { "Item 1", "Item 2", "Item 3", "Item 4", "Item 5" };
            public int getSize() { return strings.length; }
            public String getElementAt(int i) { return strings[i]; }
        });
        jScrollPane2.setViewportView(lstCoso);

        txtFav.setColumns(10);

        lblFav.setText("A agregar a Fav :");

        txtCreadorGenero.setColumns(10);

        lblCreadorGenero.setText("Im going to Alice :");

        cbxListasLPM.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Lista por defecto", "Lista particular", " " }));
        cbxListasLPM.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbxListasLPMActionPerformed(evt);
            }
        });

        lblFavList.setText("Favs :");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addGap(91, 91, 91)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(btnConfirmar, javax.swing.GroupLayout.PREFERRED_SIZE, 130, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(btnBuscar, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                .addGroup(layout.createSequentialGroup()
                                    .addComponent(lblCreadorGenero)
                                    .addGap(24, 24, 24)
                                    .addComponent(txtCreadorGenero))
                                .addGroup(layout.createSequentialGroup()
                                    .addComponent(jLabel2)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                    .addComponent(txtNick, javax.swing.GroupLayout.PREFERRED_SIZE, 165, javax.swing.GroupLayout.PREFERRED_SIZE)))
                            .addComponent(cbxListasLPM, javax.swing.GroupLayout.PREFERRED_SIZE, 124, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(69, 69, 69)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(lblFav)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtFav))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(lblFavList)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(cbxTipoCoso, javax.swing.GroupLayout.PREFERRED_SIZE, 109, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 305, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addGap(149, 149, 149))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(71, 71, 71)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(txtNick, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel2))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(btnBuscar, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(txtCreadorGenero, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(lblCreadorGenero))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(cbxListasLPM, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblFavList)
                            .addComponent(cbxTipoCoso, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 198, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtFav, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblFav))
                .addGap(18, 18, 18)
                .addComponent(btnConfirmar, javax.swing.GroupLayout.PREFERRED_SIZE, 61, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(61, 61, 61))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void btnConfirmarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnConfirmarActionPerformed

        String nick = String.valueOf(cbxTipoCoso.getSelectedItem());

        if (nick.isBlank()) {
            JOptionPane.showMessageDialog(null, "Por favor ingresa un nombre de usuario.");
        } else {
            DataCliente cli = controlCli.consultarPerfilCliente(nick);
            if (cli != null) {
                switch (nick) {
                    case "OPT" -> {
                        // pnlAU.removeAll();
                        //  pnlAU.repaint();
                        JOptionPane.showMessageDialog(null, "Elija una opcion del combo box, que no sea OPT claro.");
                    }
                    case "Tema" -> {
                        this.cargarLstFav(controlCli.obtenerTemaFavCliente(nick));
                        DataTema tema = new DataTema(txtFav.getText(), 0);
                        controlCli.agregarTema(cli, tema);
                    }
                    case "Lista" ->
                        this.cargarLstFav(controlCli.obtenerListasFavCliente(nick));
                    case "Album" ->
                        this.cargarLstFav(controlCli.obtenerAlbumFavCliente(nick));
                }
            } else {
                JOptionPane.showMessageDialog(null, "No existe usuario a ese nick.");
            }
        }
    }//GEN-LAST:event_btnConfirmarActionPerformed

    private void cbxTipoCosoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbxTipoCosoActionPerformed
        String nick = String.valueOf(cbxTipoCoso.getSelectedItem());

        switch (nick) {
            case "OPT" -> //No
                // pnlAU.removeAll();
                //  pnlAU.repaint();
                JOptionPane.showMessageDialog(null, "Elija una opcion del combo box, que no sea OPT claro.");
            case "Tema" -> {
                txtCreadorGenero.setVisible(false);
                lblCreadorGenero.setVisible(false);

                this.cargarLstFav(controlCli.obtenerTemaFavCliente(nick));
            }
            case "Lista" -> {
                txtCreadorGenero.setVisible(true);
                lblCreadorGenero.setVisible(true);
                this.cargarLstFav(controlCli.obtenerListasFavCliente(nick));
                String tokenLista = String.valueOf(cbxListasLPM.getSelectedItem());
                if ("Lista por defecto".equals(tokenLista)) {
                    txtCreadorGenero.setText("Genero:");
                } else {
                    txtCreadorGenero.setText("Creador:");
                }
            }
            case "Album" -> {
                txtCreadorGenero.setVisible(false);
                lblCreadorGenero.setVisible(false);
                this.cargarLstFav(controlCli.obtenerAlbumFavCliente(nick));
            }
        }
    }//GEN-LAST:event_cbxTipoCosoActionPerformed

    private void btnBuscarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnBuscarActionPerformed

        lblFav.setVisible(true);
        lstCoso.setVisible(true);
        txtFav.setVisible(true);
        btnConfirmar.setVisible(true);

        String nick = String.valueOf(cbxTipoCoso.getSelectedItem());

        if (nick.isBlank()) {
            JOptionPane.showMessageDialog(null, "Por favor ingresa un nombre de usuario.");
        } else {
            DataCliente cli = controlCli.consultarPerfilCliente(nick);
            if (cli != null) {
                switch (nick) {
                    case "OPT" -> //No
                        // pnlAU.removeAll();
                        //  pnlAU.repaint();
                        JOptionPane.showMessageDialog(null, "Elija una opcion del combo box, que no sea OPT claro.");
                    case "Tema" -> {
                        this.cargarLstFav(controlCli.obtenerTemaFavCliente(nick));
                        DataTema tema = controlTema.retornarTema(txtFav.getText());

                        //algo.corroborarVlidezDeTema(tema)
                        controlCli.agregarTema(cli, tema);
                    }
                    case "Lista" -> {
                        String tokenLista = String.valueOf(cbxListasLPM.getSelectedItem());
                        if ("Lista por defecto".equals(tokenLista)) {
                            DataListaPorDefecto lista = controlLiporde.devolverInformacion(txtFav.getText(), txtCreadorGenero.getText());
                            controlCli.agregarLista(cli, lista);
                        } else {
                            txtCreadorGenero.setText("Creador:");
                            DataListaParticular lista = controlLipa.devolverInformacion(txtFav.getText(), txtCreadorGenero.getText());
                            if (lista.getVisibilidad() == false) {
                                JOptionPane.showMessageDialog(null, "Lista que se ingresÃ³ es provada, no se puede agregar a fav.");
                            } else {
                                controlCli.agregarLista(cli, lista);
                            }
                        }
                        JOptionPane.showMessageDialog(null, "Las listas me estan dando problemas ayuda");
                    }
                    case "Album" -> {
                        this.cargarLstFav(controlCli.obtenerAlbumFavCliente(nick));

                        DataAlbum album = controlAlb.retornarInfoAlbum(txtFav.getText());
                        controlCli.agregarAlbum(cli, album);
                    }
                }
            } else {
                JOptionPane.showMessageDialog(null, "No existe usuario a ese nick.");
            }
        }
    }//GEN-LAST:event_btnBuscarActionPerformed

    private void cbxListasLPMActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbxListasLPMActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cbxListasLPMActionPerformed

    public void cargarLstFav(Collection<String> cole) {
        DefaultListModel<String> model;

        model = new DefaultListModel<>();

        for (String elemento : cole) {
            //  System.out.print("Elemento de lstSeguidos"+elemento);
            String nombre = elemento;
            model.addElement(nombre);
        }
        lstCoso.setModel(model);
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnBuscar;
    private javax.swing.JButton btnConfirmar;
    private javax.swing.JComboBox<String> cbxListasLPM;
    private javax.swing.JComboBox<String> cbxTipoCoso;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JLabel lblCreadorGenero;
    private javax.swing.JLabel lblFav;
    private javax.swing.JLabel lblFavList;
    private javax.swing.JList<String> lstCoso;
    private javax.swing.JTextField txtCreadorGenero;
    private javax.swing.JTextField txtFav;
    private javax.swing.JTextField txtNick;
    // End of variables declaration//GEN-END:variables
}
